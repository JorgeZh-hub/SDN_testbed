report: flows

inputs:
  extracted_root: "Prueba2/extracted"
  flows_glob: "rep_*/reports/flows/*.csv"
  flow_filter: [] # ejemplo: ["rtp_vc","rtp_voip"]
  group_by: ["flow", "protocol"]

# Agrupación "tipo protocolo" controlada 100% por YAML:
# - keys: el nombre del grupo (lo verás como id en summaries/plots cuando group="protocol")
# - flows: patrones (wildcards) sobre el nombre del CSV (stem), ej: "mqtt_*"
protocol_groups:
  rtp:
    flows: ["rtp_*", "voip_*"]
  mqtt:
    flows: ["mqtt_*"]
  coap:
    flows: ["coap_*"]
  amqp:
    flows: ["amqp_*"]
  # si algún flow no matchea, cae a protocol del CSV / inferencia por endpoints / "unknown"

units:
  delay: "ms"
  jitter: "ms"
  throughput: "Mbps"

metric_labels:
  delay_mean_ms: "Delay (ms)"
  jitter_mean_ms: "Jitter (ms)"
  loss_pct: "Pérdida (%)"
  throughput_total_mean_Mbps: "Throughput promedio (Mbps)"
  throughput_Mbps: "Throughput (Mbps)"

filters:
  min_count_per_row: 1
  drop_rows_with_nan_mean: true

warmup:
  mode: "none" # none | fixed | auto
  fixed_seconds: 10
  auto:
    count_th: 1
    sustain_s: 3
    max_search_s: 120
  fallback_if_not_found: 0

loss:
  sent_basis: "count_a"
  include_negative_loss: false

throughput:
  normalization: "wall" # wall | active

timeseries:
  include_warmup: true
  min_reps_per_t: 1
  crop_to_common_time: true

jitter:
  auto_detect: true
  plot_only_if_present: true

stats:
  confidence:
    enable: true
    level: 0.95
    method: "t"
  time_window:
    enable: false
    start_s: 0 # inicio relativo (s) para métricas
    end_s: 100 # fin relativo (s); null = todo
    require_full_window: true # si un CSV no llega a end_s, se marca como outlier
  outliers:
    enable: true
    metrics:
      [
        "jitter_mean_ms",
        "delay_mean_ms",
        "loss_pct",
        "throughput_total_mean_Mbps",
      ]
    zscore_threshold: 2.0

outputs:
  out_dir: "Prueba2/processed/flows"
  csv:
    rep_summary_flow: "rep_summary_flow.csv"
    rep_summary_protocol: "rep_summary_protocol.csv"
    load_summary_flow: "load_summary_flow.csv"
    load_summary_protocol: "load_summary_protocol.csv"
    ts_throughput_flow: "ts_throughput_flow.csv"
    ts_throughput_protocol: "ts_throughput_protocol.csv"
    missing: "missing_flows.csv"
    outliers: "outliers_removed.csv"
    time_coverage: "time_coverage.csv"
  plots_dir: "Prueba2/processed/flows/plots"

plots:
  delay_vs_load:
    enable: false
    group: "flow" # flow | protocol
    id_labels:
      {
        amqp_iot_pub: "AMQP",
        coap_iot_sent: "CoAP",
        http_med_post: "HTTP",
        mqtt_sec_pub: "MQTT 1",
        mqtt_sec_sub: "MQTT 2",
        mqtt_sis_sub: "MQTT 4",
        rtp_iptv_rec: "RTP",
        rtp_vc: "VideoConferencia",
        rtp_voip: "Voz",
        udp_noise: "UDP",
        wb_iot_post: "WebSockets",
      }
    y_break:
      {
        amqp_iot_pub: [[0, 1], [5, 800]],
        coap_iot_sent: [[0, 1], [1, 20]],
        http_med_post: [[0, 1], [1, 20]],
        mqtt_sec_pub: [[0, 1], [5, 800]],
        mqtt_sec_sub: [[0, 1], [5, 200]],
        mqtt_sis_sub: [[0, 1], [1, 150]],
        rtp_iptv_rec: [[0, 10], [10, 300]],
        rtp_vc: [[0, 0.4], [1, 5]],
        rtp_voip: [[0, 0.4], [1, 280]],
        udp_noise: [[0, 1], [1, 300]],
        wb_iot_post: [[0, 1], [1, 150]],
      }
    interpolate: false
    metric: "delay_mean_ms"
    labels:
      title: "Retardo vs carga - {id}"
      xlabel: "Carga"
      ylabel: "Retardo (ms)"
      legend: "Controlador"
    grid: true

  jitter_vs_load:
    enable: false
    group: "flow"
    id_labels:
      {
        amqp_iot_pub: "AMQP",
        coap_iot_rec: "CoAP",
        coap_iot_sent: "CoAP",
        http_med_post: "HTTP",
        mqtt_sec_pub: "MQTT 1",
        mqtt_sec_sub: "MQTT 2",
        mqtt_sis_pub: "MQTT 3",
        mqtt_sis_sub: "MQTT 4",
        rtp_iptv_rec: "RTP",
        rtp_vc: "VideoConferencia",
        rtp_voip: "Voz",
        udp_noise: "UDP",
        wb_iot_post: "WebSockets",
      }
    interpolate: false
    y_break: {}
    metric: "jitter_mean_ms"
    labels:
      title: "Jitter vs load - {id}"
      xlabel: "Carga"
      ylabel: "Jitter (ms)"
      legend: "Controlador"
    grid: false

  loss_bars:
    enable: false
    group: "flow"
    id_labels:
      {
        amqp_iot_pub: "AMQP",
        coap_iot_rec: "CoAP",
        coap_iot_sent: "CoAP",
        http_med_post: "HTTP",
        mqtt_sec_pub: "MQTT 1",
        mqtt_sec_sub: "MQTT 2",
        mqtt_sis_pub: "MQTT 3",
        mqtt_sis_sub: "MQTT 4",
        rtp_iptv_rec: "RTP",
        rtp_vc: "VideoConferencia",
        rtp_voip: "Voz",
        udp_noise: "UDP",
        wb_iot_post: "WebSockets",
      }
    y_break: {}
    interpolate: false
    metric: "loss_pct"
    loads: "all" # o lista: ["1a","2a","4a"]
    labels:
      title: "Pérdida vs carga - {id}"
      xlabel: "Carga"
      ylabel: "Pérdida (%)"
      legend: "Controlador"
    grid: false

  throughput_bars:
    enable: false
    group: "flow"
    id_labels:
      {
        amqp_iot_pub: "AMQP",
        coap_iot_rec: "CoAP",
        coap_iot_sent: "CoAP",
        http_med_post: "HTTP",
        mqtt_sec_pub: "MQTT 1",
        mqtt_sec_sub: "MQTT 2",
        mqtt_sis_pub: "MQTT 3",
        mqtt_sis_sub: "MQTT 4",
        rtp_iptv_rec: "RTP",
        rtp_vc: "VideoConferencia",
        rtp_voip: "Voz",
        udp_noise: "UDP",
        wb_iot_post: "WebSockets",
      }
    y_break: {}
    interpolate: false
    metric: "throughput_total_mean_Mbps"
    loads: "all" # o lista: ["1a","2a","4a"]
    labels:
      title: "Throughput promedio vs load - {id}"
      xlabel: "Carga"
      ylabel: "Throughput (Mbps)"
      legend: "Controlador"
    grid: false

  compare_flows_by_controller:
    enable: true
    legend_loc: "upper left" # esquina: upper/lower left/right
    font_size: 9 # base
    title_size: 11
    label_size: 12
    tick_size: 11
    legend_font_size: 11
    fig_width: 10 # ancho en pulgadas
    fig_height: 6 # alto en pulgadas
    load_suffix: "n" # cambia el sufijo de la carga: 2a -> 2n
    group: "flow"
    controllers: "all" # o lista: ["Baseline","TE"]
    loads: ["0a", "1a", "2a", "3a", "4a", "5a", "6a", "7a", "8a", "9a"] # # o lista: ["1a","2a","4a"]
    id_labels:
      {
        mqtt_sec_sub: "MQTT-IOT",
        rtp_iptv_rec: "RTP-IPTV",
        rtp_voip: "RTP-VoIP",
        udp_noise: "UDP-Ruido",
      }
    metrics:
      [
        "throughput_total_mean_Mbps",
        "loss_pct",
        "delay_mean_ms",
        "jitter_mean_ms",
      ]
    y_break:
      loss_pct: {}
    interpolate: false
    grid: true
    labels:
      title: ""
      xlabel: "Carga"
      ylabel: ""
      legend: "Flujo"

  # Curvas 1 por controlador, para una carga seleccionada
  throughput_timeseries:
    enable: false
    group: "flow"
    select:
      load: "1a"
      id: ["wb_iot_post", "rtp_iptv_rec", "rtp_voip", "udp_noise"]
      controller: "" # o ["baseline","te"]
    id_labels:
      {
        wb_iot_post: "WebSockets",
        rtp_iptv_rec: "Video",
        rtp_voip: "Voz",
        udp_noise: "UDP",
      }
    labels:
      title: "Throughput vs tiempo"
      xlabel: "Tiempo (s)"
      ylabel: "Throughput (Mbps)"
      legend: "Flujo"
    show_ci: true
    smooth:
      enable: false
      window_points: 3

  # ✅ NUEVO: Curvas 1 por carga, para un (flow/protocol, controller) — o all
  throughput_timeseries_loads:
    enable: true
    group: "flow" # flow | protocol
    select:
      id: ["mqtt_sec_sub", "rtp_iptv_rec", "rtp_voip", "udp_noise"]
      controller: "Prueba" # o "baseline"
      loads: "all" # o ["0.6a","1.2a","2a"]
    id_labels:
      {
        mqtt_sec_sub: "MQTT",
        rtp_iptv_rec: "IPTV",
        rtp_voip: "Voz",
        udp_noise: "UDP",
      }
    labels:
      title: "Throughput vs tiempo - {id} - {controller}"
      xlabel: "Tiempo (s)"
      ylabel: "Throughput (Mbps)"
      legend: ""
    show_ci: true
    smooth:
      enable: false
      window_points: 3

  # ✅ NUEVO: Curvas 1 por carga, para un (flow/protocol, controller) — o all
  throughput_timeseries_compare:
    enable: false
    faceted: true
    legend_loc: "upper right"
    font_size: 9
    title_size: 9
    tick_size: 9
    legend_font_size: 9
    group: "flow" # flow | protocol
    select:
      id: ["coap_iot_sent", "rtsp_vod_rec", "rtp_vc", "ftp_transfer"]
      controller: "OSPF" # o "baseline"
      loads: ["4a"] # o ["0.6a","1.2a","2a"]
    id_labels:
      {
        coap_iot_sent: "Telemetría IoT - CoAP (3 conexiones)",
        rtsp_vod_rec: "Transmisión de video de baja calidad - RTP (4 conexiones)",
        rtp_vc: "Video Conferencia - RTP (40 conexiones)",
        ftp_transfer: "Transferencia de archivos - FTP (4 conexiones)",
      }
    labels:
      title: ""
      xlabel: "Tiempo (s)"
      ylabel: "Throughput (Mbps)"
      legend: ""
    show_ci: false
    grid: true
    smooth:
      enable: false
      window_points: 3
